<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito Comentado Paso a Paso</title>
    
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        .caja-input { background: #f0f0f0; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        input { padding: 8px; margin-right: 5px; }
        button { cursor: pointer; padding: 8px 15px; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        .producto { border-bottom: 1px solid #ccc; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .btn-rojo { background: #dc3545; margin-left: 10px; }
        .total { font-size: 1.2em; font-weight: bold; margin-top: 20px; text-align: right; }
    </style>
</head>
<body>

    <h1>Carrito de Compras</h1>

    <div class="caja-input">
        <h3>1. Añadir Producto</h3>
        <input type="text" id="nombreProducto" placeholder="Ej: Pan">
        <input type="number" id="precioProducto" placeholder="Ej: 1.50">
        <button onclick="añadir()">Añadir al carro</button>
    </div>

    <h3>2. Lista de compra:</h3>
    <div id="listaVisual">
        <p>El carrito está vacío.</p>
    </div>

    <div id="zonaTotal" class="total"></div>

    <script>
        // PASO 1: Crear la "memoria" del carrito
        // Es una lista (array) vacía donde guardaremos los objetos producto.
        let baseDeDatosCarrito = [];

        // PASO 2: Función para AÑADIR productos
        const añadir = () => {
            // a) Capturamos lo que el usuario escribió en los inputs
            const inputNombre = document.getElementById('nombreProducto');
            const inputPrecio = document.getElementById('precioProducto');
            
            const nombre = inputNombre.value; 
            const precio = parseFloat(inputPrecio.value); // Convertimos texto a número decimal

            // b) Validación: Si no hay nombre o el precio está mal, paramos.
            if (nombre === '' || isNaN(precio) || precio <= 0) {
                alert("Por favor, pon un nombre y un precio válido.");
                return; // Stop, no seguimos
            }

            // c) Comprobar duplicados: ¿Ya existe este producto?
            // Buscamos en la lista si hay algo con el mismo nombre
            const encontrado = baseDeDatosCarrito.find(item => item.nombre === nombre);

            if (encontrado) {
                // Si existe, solo aumentamos la cantidad
                encontrado.cantidad++;
            } else {
                // Si NO existe, creamos un objeto nuevo y lo metemos en la lista
                const nuevoProducto = {
                    id: Date.now(), // Creamos un ID único basado en la hora actual
                    nombre: nombre,
                    precio: precio,
                    cantidad: 1
                };
                baseDeDatosCarrito.push(nuevoProducto);
            }

            // d) Limpiamos los inputs para que queden vacíos
            inputNombre.value = '';
            inputPrecio.value = '';

            // e) IMPORTANTE: Llamamos a la función que "pinta" la pantalla de nuevo
            actualizarPantalla();
        };

        // PASO 3: Función para ELIMINAR productos
        const eliminar = (idParaBorrar) => {
            // Filtramos la lista: Nos quedamos con todos MENOS el que tiene ese ID
            baseDeDatosCarrito = baseDeDatosCarrito.filter(item => item.id !== idParaBorrar);
            
            // Volvemos a pintar la pantalla con la lista actualizada
            actualizarPantalla();
        };

        // PASO 4: Función maestra para ACTUALIZAR LA PANTALLA (Renderizar)
        const actualizarPantalla = () => {
            // a) Buscamos el contenedor donde van los productos
            const contenedor = document.getElementById('listaVisual');
            const contenedorTotal = document.getElementById('zonaTotal');

            // b) Si está vacío, mostramos mensaje y salimos
            if (baseDeDatosCarrito.length === 0) {
                contenedor.innerHTML = "<p>El carrito está vacío.</p>";
                contenedorTotal.innerHTML = "";
                return;
            }

            // c) Si hay cosas, limpiamos el contenedor antes de repintar
            contenedor.innerHTML = '';

            // d) Recorremos la lista y creamos el HTML de cada producto
            // Usamos .map() para transformar los datos en HTML
            baseDeDatosCarrito.forEach(producto => {
                const totalProducto = (producto.cantidad * producto.precio).toFixed(2);
                
                // Creamos un div nuevo por cada producto
                const elementoDiv = document.createElement('div');
                elementoDiv.classList.add('producto');
                
                // Rellenamos el div con la información
                elementoDiv.innerHTML = `
                    <span>
                        <strong>${producto.nombre}</strong> 
                        (x${producto.cantidad}) - ${totalProducto}€
                    </span>
                    <button class="btn-rojo" onclick="eliminar(${producto.id})">Eliminar</button>
                `;

                // Lo metemos dentro del contenedor principal
                contenedor.appendChild(elementoDiv);
            });

            // e) Calculamos el precio TOTAL de todo el carro
            // reduce recorre y va sumando (acumulando) el precio
            const totalPagar = baseDeDatosCarrito.reduce((acumulador, item) => {
                return acumulador + (item.precio * item.cantidad);
            }, 0);

            // f) Escribimos el total final en pantalla
            contenedorTotal.innerHTML = `Total a Pagar: ${totalPagar.toFixed(2)}€`;
        };
    </script>
</body>
</html>