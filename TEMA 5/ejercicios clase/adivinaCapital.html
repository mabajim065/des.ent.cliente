<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <title>Adivina la capital</title>
    <style>
        body {
            font-family: system-ui, Segoe UI, Arial;
            margin: 20px
        }

        input[type=text] {
            padding: 6px;
            margin: 4px 0
        }

        .error {
            color: #b00;
            margin-left: 8px
        }

        #mask {
            font-size: 1.4rem;
            letter-spacing: 4px
        }

        button {
            padding: 6px 10px;
            margin-left: 6px
        }
    </style>
</head>

<body>
    <h2>üîç Adivina la capital</h2>

    <div id="setup">
        <p>Introduce 6 capitales (m√≠nimo 5 caracteres cada una):</p>
        <form id="capsForm" autocomplete="off">
            <div id="inputs"></div>
            <button type="submit">Validar y comenzar</button>
        </form>
        <div id="setupMsg"></div>
    </div>

    <div id="game" style="display:none;">
        <p id="mask"></p>
        <p id="attemptMsg"></p>
        <input type="text" id="guessInput" placeholder="Escribe tu intento" />
        <button id="guessBtn">Probar</button>
        <div id="result" style="margin-top:10px"></div>
        <button id="playAgain" style="display:none;margin-top:10px">Jugar otra vez</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const inputsDiv = document.getElementById('inputs');
            for (let i = 0; i < 6; i++) {
                const div = document.createElement('div');
                div.innerHTML = `<label>Capital ${i + 1}: <input type="text" name="cap${i}" required minlength="5"></label> <span class="error"></span>`;
                inputsDiv.appendChild(div);
            }

            const form = document.getElementById('capsForm');
            const setupMsg = document.getElementById('setupMsg');

            form.addEventListener('submit', e => {
                e.preventDefault();
                const formData = new FormData(form);
                const caps = [];
                let valid = true;
                for (let i = 0; i < 6; i++) {
                    const val = (formData.get('cap' + i) || '').trim();
                    const input = form.querySelector(`input[name="cap${i}"]`);
                    const errSpan = input.nextElementSibling;
                    if (val.length < 5) {
                        errSpan.textContent = ' Debe tener al menos 5 caracteres.';
                        valid = false;
                    } else {
                        errSpan.textContent = '';
                        caps.push(val.toLowerCase());
                    }
                }
                if (!valid) {
                    setupMsg.textContent = 'Corrige los errores y vuelve a enviar.';
                    return;
                }
                setupMsg.textContent = '';
                startGame(caps);
            });

            function startGame(caps) {
                window.caps = caps;
                document.getElementById('setup').style.display = 'none';
                document.getElementById('game').style.display = 'block';
                playRound();
            }

            function playRound() {
                window.target = caps[Math.floor(Math.random() * caps.length)];
                window.revealCount = 0;
                window.totalLetters = [...window.target].filter(ch => ch.trim() !== '').length;
                updateMask();
                document.getElementById('result').textContent = '';
                document.getElementById('attemptMsg').textContent = 'Adivina la capital';
                document.getElementById('guessInput').value = '';
                document.getElementById('guessInput').disabled = false;
                document.getElementById('guessBtn').disabled = false;
                document.getElementById('playAgain').style.display = 'none';
                document.getElementById('guessInput').focus();
            }

            function getMask(target, revealCount) {
                let lettersShown = 0;
                let out = [];
                for (const ch of target) {
                    if (ch.trim() === '') { out.push(' '); continue; }
                    if (lettersShown < revealCount) { out.push(ch); lettersShown++; }
                    else out.push('_');
                }
                return out.join(' ');
            }

            function updateMask() {
                document.getElementById('mask').textContent = getMask(window.target, window.revealCount);
            }

            document.getElementById('guessBtn').addEventListener('click', makeGuess);
            document.getElementById('guessInput').addEventListener('keydown', e => { if (e.key === 'Enter') makeGuess(); });

            function makeGuess() {
                const guess = document.getElementById('guessInput').value.trim().toLowerCase();
                if (!guess) { alert('Introduce un intento.'); return; }
                if (guess === window.target) {
                    document.getElementById('result').innerHTML = `‚úÖ <strong>¬°Correcto! La capital era <code>${window.target}</code>.</strong>`;
                    endRound(true);
                    return;
                }
                window.revealCount++;
                updateMask();
                if (window.revealCount >= window.totalLetters) {
                    document.getElementById('result').innerHTML = `‚ùå <strong>Has perdido. Era <code>${window.target}</code>.</strong>`;
                    endRound(false);
                    return;
                }
                document.getElementById('attemptMsg').textContent = `Intento fallido ‚Äî pista: ${getMask(window.target, window.revealCount)}`;
                document.getElementById('guessInput').value = '';
                document.getElementById('guessInput').focus();
            }

            function endRound(win) {
                document.getElementById('guessBtn').disabled = true;
                document.getElementById('guessInput').disabled = true;
                document.getElementById('playAgain').style.display = 'inline-block';
            }

            document.getElementById('playAgain').addEventListener('click', () => playRound());
        });
    </script>
</body>

</html>